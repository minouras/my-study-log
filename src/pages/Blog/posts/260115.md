# 今回は練習用なので入ってたデータ1こデリートして解決した。

# 本番運用で必須スキーマを増やすって大変なんだな。

# ふと思ったのだが、microCMSやwordpressのフィールドはどうなっているんだろう。ユーザーが必須フィールドを増やした場合、それまでの記事が消えることも無いし必須フィールドの追加を拒否されることもないが、どういう処理にしているんだ？

---

面白いところに気づいたね。  
Prisma のような「RDB の実テーブルを直接いじる」仕組みと、microCMS や WordPress のような「アプリ側で抽象化されたコンテンツ管理」を比べると、**必須フィールド追加時の挙動がまったく違う理由**が見えてくる。

結論から言うと、microCMS や WordPress は **DB スキーマを直接いじらず、アプリ側で柔軟に吸収する仕組み**を持っているから、必須フィールドを追加しても既存データが壊れない。

---

## 🧩 microCMS の場合：そもそも RDB ではない（スキーマレス）

microCMS は内部的に **スキーマレスな NoSQL（またはそれに近い構造）** を使っていると言われている。

### ✔ 必須フィールドを追加しても既存データが壊れない理由

- 既存のコンテンツは「そのフィールドが無い状態」で保存されているだけ
- 新しい必須フィールドは「今後の投稿・更新時に必須」になる
- 既存データは「そのフィールドが null（未設定）」として扱われる

つまり、**DB のテーブルに新しい NOT NULL カラムを追加しているわけではない**。

### ✔ 例えるなら

JSON の配列に新しいキーを追加しても、古い JSON が壊れないのと同じ。

```json
// 既存データ
{
  "title": "記事1"
}

// 新しい必須フィールド "author" を追加しても…
{
  "title": "記事1",
  "author": null // こんな扱いになる
}
```

---

## 🧩 WordPress の場合：メタデータ方式で柔軟に拡張

WordPress は MySQL を使っているけど、**記事のカスタムフィールドはテーブルのカラムではなく、メタデータとして保存される**。

### ✔ 仕組み

- 投稿本体：`wp_posts`
- カスタムフィールド：`wp_postmeta`（key-value 形式）

### ✔ 必須フィールドを追加しても問題ない理由

- 新しいフィールドは `wp_postmeta` に「必要なときだけ」追加される
- 既存の記事にはその key が存在しないだけ
- WordPress 側が「必須チェック」を UI で行うだけで、DB の NOT NULL 制約ではない

つまり、**DB スキーマは変わらない**。

---

## 🧩 Prisma（RDB）との違いがここにある

Prisma は **実際の RDB のテーブル構造を変更する**。

- 必須カラム（NOT NULL）を追加すると、既存レコードにも値が必要
- SQLite や MySQL は「NOT NULL カラム追加時に既存データをどう埋めるか」を問う
- だからマイグレーションが失敗する

一方、microCMS や WordPress は：

- **DB スキーマを変更しない**
- **アプリ側で「必須チェック」をしているだけ**
- **既存データは null 扱いで許容**

この違いが大きい。

---

## 🧠 まとめ

| サービス          | 必須フィールド追加時の挙動                       | なぜ壊れない？        |
| ----------------- | ------------------------------------------------ | --------------------- |
| **Prisma（RDB）** | DB の NOT NULL カラム追加 → 既存データに値が必要 | RDB の制約が厳しい    |
| **microCMS**      | スキーマレス → 既存データは null 扱い            | JSON のように柔軟     |
| **WordPress**     | メタデータ方式 → key が無いだけ                  | DB スキーマを変えない |

---

## 💬 ちょっとした感想

本番運用で RDB の必須カラムを追加するのが大変なのは、まさにこの「RDB の厳密さ」が理由なんだよね。  
CMS が柔軟に見えるのは、裏側で「スキーマを DB に押し付けない」設計をしているから。

もし興味あれば、**「RDB で安全に必須カラムを追加するパターン」**も解説できるよ。

---

# なるほど。それを聞いているとバックのデータ管理もRDBじゃなくてスキーマレスなNoSQLの方が優秀なんじゃないかと思ってしまうけど、世の中のアプリケーションのバックエンドは大体RDBだよね。Json的なNoSQLじゃなくてRDBじゃなきゃダメな理由とかあるの？

---

めちゃくちゃ良い視点だと思う。  
「スキーマレスの方が柔軟で便利そうなのに、なぜ世の中はまだ RDB を使い続けるのか？」  
これはエンジニア界隈でもずっと議論されてきたテーマなんだよね。

結論から言うと、**NoSQL が優秀なのは “柔軟さ” であって、RDB が優秀なのは “厳密さと一貫性”**。  
アプリケーションの性質によって、どちらが向いているかが変わる。

---

## 🧱 RDB が今でも主流であり続ける理由

### 1. 🔒 **データの整合性（ACID）が圧倒的に強い**

RDB は ACID 特性を持っていて、これがとにかく強い。

- **A**tomicity（原子性）
- **C**onsistency（一貫性）
- **I**solation（独立性）
- **D**urability（永続性）

例えば：

- 銀行の振込
- 在庫管理
- 予約システム
- 会計処理

こういう「絶対に矛盾があってはならない」データは、RDB の厳密さが必要。

NoSQL は柔軟だけど、整合性は弱い（最終的整合性など）。

---

### 2. 🧩 **複雑なクエリ（JOIN）が強い**

RDB は JOIN が得意。

- 「ユーザーと注文と商品をまとめて取得」
- 「特定の条件で集計」
- 「ランキングを作る」

こういう複雑な問い合わせは RDB の方が圧倒的に楽。

NoSQL は JOIN が弱い（または無い）。  
JOIN が必要な場合、アプリ側で頑張る必要がある。

---

### 3. 📊 **データ構造が安定している場合はスキーマが強い**

業務システムの多くは、実はそんなに頻繁にスキーマが変わらない。

- 顧客
- 注文
- 商品
- 在庫

こういうデータは「構造が安定している」ので、RDB のスキーマがむしろ安心。

---

### 4. 🛠️ **ツール・エコシステムが成熟している**

RDB は歴史が長いので、周辺ツールが豊富。

- SQL（標準化された言語）
- トランザクション管理
- バックアップ・リストア
- モニタリング
- ORM（Prisma など）

NoSQL は種類ごとに API やクエリが違うので、統一性が弱い。

---

### 5. 👥 **チーム開発での安心感**

スキーマがあると、チーム全体で「データの形」が共有される。

- 型がある
- 制約がある
- 間違ったデータが入りにくい

NoSQL は自由すぎて、チームが大きくなるほど「データの揺れ」が問題になる。

---

## 🌲 NoSQL が優秀な場面ももちろんある

逆に、NoSQL が圧倒的に強いケースもある。

### 1. 🧩 スキーマが頻繁に変わる

CMS、SNS、ログデータなど。

### 2. ⚡ 超高速な書き込みが必要

ログ、イベントストリームなど。

### 3. 🌍 分散システムでスケールが必要

大量アクセスの Web サービスなど。

### 4. 🧺 JSON のような柔軟な構造が必要

ドキュメント型データ。

---

## 🧠 まとめ：どっちが優秀かではなく、用途が違う

| 特徴       | RDB                    | NoSQL                    |
| ---------- | ---------------------- | ------------------------ |
| スキーマ   | 固定                   | 柔軟                     |
| 整合性     | 強い                   | 弱い（最終的整合性など） |
| JOIN       | 強い                   | 弱い                     |
| スケール   | 垂直スケール中心       | 水平スケールが得意       |
| データ構造 | 安定している           | 変化しやすい             |
| 典型用途   | 業務システム、金融、EC | CMS、SNS、ログ、IoT      |

---

## 💬 個人的な見解（あなたの疑問に寄り添うと）

「スキーマレスの方が柔軟で便利そう」という感覚は正しい。  
ただ、**柔軟さは “自由” であると同時に “危険” でもある**。

RDB は「厳密さ」という安全装置を提供してくれる。  
だから、ビジネスの根幹データは今でも RDB が選ばれる。

---

もし興味があれば、  
**「Prisma で NoSQL 的な柔軟さを持たせる設計」**  
みたいな話もできるよ。
